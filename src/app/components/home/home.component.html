<div class="max-w-3xl mx-auto p-4" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="300"
  (scrolled)="onScroll()">
  <div class="flex justify-center mt-10">
    <button (click)="AddProduct()"
      class="flex items-center justify-between gap-3 text-black font-medium py-2 px-4 rounded-xl transition w-full max-w-[250px] border border-gray-300 bg-transparent hover:bg-gray-100">

      <span>What is new ?</span>
      <div class="flex items-center gap-2">
        <div class="p-1 bg-black text-white rounded-md">
          <lucide-icon [img]="PlusCircle" class="w-4 h-4" />
        </div>
        <div class="p-1 bg-black text-white rounded-md">
          <lucide-icon [img]="Image" class="w-4 h-4" />
        </div>
      </div>


    </button>
  </div>



  <div *ngFor="let post of posts; let i = index" class="bg-white shadow rounded-xl p-4 mb-6 w-full max-w-xl mx-auto">
    <!-- Header -->
    <div class="flex items-start justify-between">
      <div class="flex gap-3 items-center">
        <img [src]="post.user.image" class="w-10 h-10 rounded-full" />
        <div>
          <p class="font-semibold text-gray-900">{{ post.user.name }}</p>
          <p class="text-sm text-gray-500">{{ post.createdAt | date: 'medium' }}</p>
        </div>
      </div>
      <div class="relative" #menuWrapper>
        <lucide-icon [img]="MoreVertical" class="w-5 h-5 cursor-pointer text-gray-600"
          (click)="toggleMenu(i)"></lucide-icon>
        <div *ngIf="isMenuOpen(i)" class="absolute right-0 mt-2 w-32 bg-white border shadow-md rounded z-50">
          <div class="p-2 hover:bg-gray-100 cursor-pointer text-sm" (click)="UpdatePost(post)">Edit</div>
          <div class="p-2 hover:bg-gray-100 cursor-pointer text-sm" (click)="DeletePost(post)">Delete</div>
        </div>
      </div>
    </div>

    <!-- Content -->
    <p class="mt-3 text-gray-800">{{ post.content }}</p>
    <img *ngIf="post.image" [src]="post.image" class="w-full mt-4 rounded-lg max-h-[400px] object-cover" />

    <!-- Actions -->
    <div class="flex gap-6 mt-4 text-gray-500">
      <div class="flex items-center gap-1 cursor-pointer" (click)="toggleLike(post)">
        <lucide-icon [img]="Heart" [ngClass]="post.liked ? 'text-red-500' : 'text-gray-500'"
          class="w-5 h-5 transition-colors duration-200" />
        <span>{{ post.likes }}</span>
      </div>
      <div class="flex items-center gap-1 cursor-pointer">
        <lucide-icon [img]="MessageCircle" class="w-5 h-5" />
        <span>{{ post.comments.length }}</span>
      </div>
      <div class="flex items-center gap-1 cursor-pointer">
        <lucide-icon [img]="Share2" class="w-5 h-5" />
      </div>
    </div>

    <!-- Comments -->
    <div class="mt-4 space-y-3">
      <div *ngFor="let comment of post.comments.slice(0, 2); let j = index" class="flex gap-3">
        <img [src]="comment.user?.image || 'https://i.pravatar.cc/40?img=' + (j + 3)" class="w-8 h-8 rounded-full" />
        <div class="flex-1 bg-gray-100 p-2 rounded-md relative">
          <div class="flex justify-between">
            <strong class="text-sm">{{ comment.user?.name || 'Unknown' }}</strong>

          </div>
          <p class="text-sm text-gray-800">{{ comment.content }}</p>
          <p class="text-xs text-gray-400 mt-1">{{ commentDate(comment) }}</p>
        </div>
      </div>
    </div>

    <!-- Add Comment -->
    <div class="flex items-center mt-4 border rounded px-3 py-2">
      <input type="text" [(ngModel)]="newComment.content" placeholder="Add Comment..."
        class="flex-1 outline-none bg-transparent" />
      <lucide-icon [img]="Send" class="w-5 h-5 text-blue-600 cursor-pointer" (click)="addComment(post.id)" />
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="text-center text-gray-500 my-4">
    Loading...
  </div>
</div>